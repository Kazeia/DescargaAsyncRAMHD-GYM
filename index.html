<html>
<!-- LINK PDF COMPARTIDO -->
<!-- https://drive.google.com/file/d/0Bxnfj-yjKsboclQ0S005VWctWUU/view -->

<!-- LINK PDF COMPARTIDO DIRECTO A DESCARGA -->
<!-- https://drive.google.com/uc?id=0Bxnfj-yjKsboclQ0S005VWctWUU&export=download -->
<!-- RESPONSE 302 -> Q REDIRIGE AL LINK DIRECTO DE DESCARGA -->
<!-- DE ESE LINK SE DEBERA SAKAR EL CONTENTLENGTH Y DESCARGAR EL ARHCHIV -> XHR.RESPONSE -->
<iframe id="iFramePDF" name="iFramePDF" src="" width="100%" height="100%" frameBorder="0" styele="display:none"></iframe>

<script>

    //Funcion que permite formatear bytes a KB, MB, GB, etc.
    formatBytes = (bytes, decimals) => {
        if (bytes == 0) return '0 Bytes';
        var k = 1024,
            dm = decimals || 2,
            sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'],
            i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
    }

    //Funcion que permite obtener del responseHeader.Disposition el nombre del archivo.
    getFileName = (disposition) => {
        if (disposition && disposition.indexOf('attachment') !== -1) {
            var filenameRegex = /filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/;
            var matches = filenameRegex.exec(disposition);
            if (matches != null && matches[1]) filename = matches[1].replace(/['"]/g, '');
        }
    }

    //Error Handler para FileSystem API
    function errorHandlerFileSystem(e) {
        var msg = '';
        // switch (e.code) {
        //deprecated
        //     case FileError.QUOTA_EXCEEDED_ERR:
        //         msg = 'QUOTA_EXCEEDED_ERR';
        //         break;
        //     case FileError.NOT_FOUND_ERR:
        //         msg = 'NOT_FOUND_ERR';
        //         break;
        //     case FileError.SECURITY_ERR:
        //         msg = 'SECURITY_ERR';
        //         break;
        //     case FileError.INVALID_MODIFICATION_ERR:
        //         msg = 'INVALID_MODIFICATION_ERR';
        //         break;
        //     case FileError.INVALID_STATE_ERR:
        //         msg = 'INVALID_STATE_ERR';
        //         break;
        //     default:
        //         msg = 'Unknown Error';
        //         break;
        // };
        console.log(e);
    }
    abrirPDF = () => {
        fileSystem.root.getFile(filename, null, function (fileEntry) {
            fileEntry.file(function (file) {

                var urlBuilder = window.URL || window.webkitURL;
                document.getElementById("iFramePDF").src = urlBuilder.createObjectURL(file);
                document.getElementById("iFramePDF").style.display = 'block';
                // if (window.webkitURL)  // Chrome 10 & 11
                //     var url = window.webkitURL.createObjectURL(file);
                // else // Chrome 9
                //     var url = createObjectURL(file);
                // document.getElementById('video').src = url;
                // // Assigning the url
                // if (window.webkitURL) // Chrome 10 & 11
                //     var url = window.webkitURL.revokeObjectURL(file);
                // else // Chrome 9
                //     var url = revokeObjectURL(file);
            }, errorHandlerFileSystem);
        }, errorHandlerFileSystem);
    }

    /*MAIN*/

    window.requestFileSystem = window.requestFileSystem || window.webkitRequestFileSystem;

    //Variable XMLHttpRequest, para realizarlo a full vanillaJS, :p xd, se pueden utilizar otras tecnologias como AJAX, JQUERY, ETC.
    var xhr = new XMLHttpRequest();

    //Abrimos una consulta GET a un archivo de Drive con LINK Publico | true = Async, false = Sync
    xhr.open("GET", "https://cors-anywhere.herokuapp.com/https://drive.google.com/uc?id=0Bxnfj-yjKsboclQ0S005VWctWUU&export=download", true);
    //#Opcional Tipo Blob 
    xhr.responseType = 'blob';
    //#Opcional Tipo MimeType
    // xhr.overrideMimeType('application/pdf; charset=UTF-8');

    xhr.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {

            //Peso del Archivo
            var sizeFileBytes = xhr.getResponseHeader("Content-Length");
            console.log("TamaÃ±o de archivo: " + formatBytes(sizeFileBytes));

            //Nombre del Archivo
            var disposition = xhr.getResponseHeader('Content-Disposition');
            var fileName = getFileName(disposition)
            console.log("Nombre del archivo: " + filename)

            //Si se optiene una respuesta del servidor -> envia como chunks a xhr.response, en caso se haya abierto el xhr como Async, de lo contrario detendra el hilo principal hasta q se haya descargado el archivo
            if (xhr.response) {
                navigator.webkitPersistentStorage.requestQuota(sizeFileBytes, function (grantedBytes) {
                    window.requestFileSystem(PERSISTENT, grantedBytes, function (fs) {
                        fs.root.getFile(filename, { create: true }, function (fileEntry) {
                            fileEntry.createWriter(function (writer) {

                                // console.log("1")
                                // var bb = new (window.MozBlobBuilder || window.WebKitBlobBuilder || window.BlobBuilder)();
                                // bb.append(xhr.response);
                                // console.log("2")
                                // writer.write(bb.getBlob('application/pdf'));
                                // console.log("3")
                                var blob = new Blob([xhr.response]);
                                writer.write(blob);
                                console.log(blob)

                            }, errorHandlerFileSystem);
                        }, errorHandlerFileSystem);
                    }, errorHandlerFileSystem);
                    abrirPDF(filename);
                }, errorHandlerFileSystem);
            }

            // console.log(xhr.response)
        }
    };

    // xhr.onprogress = function () {
    // 	// var curr_index = xhr.responseText.length;
    // 	// if (last_index == curr_index) return;
    // 	// var s = xhr.responseText.substring(last_index, curr_index);
    // 	// last_index = curr_index;
    // 	// console.log(s);
    // }
    xhr.send();

</script>